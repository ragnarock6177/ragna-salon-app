@use '@angular/material' as mat;

@include mat.core();

/* --- 1. Define Design Tokens (Variables) --- */
$_slate-950: var(--color-slate-950);
$_slate-900: var(--color-slate-900);
$_slate-800: var(--color-slate-800);
$_slate-700: var(--color-slate-700);
$_slate-600: var(--color-slate-600);
$_slate-500: var(--color-slate-500);
$_slate-400: var(--color-slate-400);
$_slate-300: var(--color-slate-300);
$_slate-200: var(--color-slate-200);
$_slate-100: var(--color-slate-100);
$_slate-50: var(--color-slate-50);
$_white: var(--color-white);
$_sky-500: var(--color-sky-500);
$_sky-600: var(--color-sky-600); // Darker sky for hover
$_sky-500-fade: rgba(var(--color-sky-500), 0.15);
$_error: var(--color-error);
$_gray_100 : var(--color-gray-100);
$_shadow-sm: 0 1px 3px 0 var(--tw-shadow-color, rgb(0 0 0 / 0.1)), 0 1px 2px -1px var(--tw-shadow-color, rgb(0 0 0 / 0.1));
$_gray-50: #f9fafb; // Tailwind bg-gray-50
$_slate-900: #0f172a; // Tailwind slate-900
$_border-light: #e2e8f0; // slate-200
$_border-dark: #1e293b; // slate-800
$_rounded-sm: var(--radius-sm);
$_rounded-md: var(--radius-md);
$_rounded-lg: var(--radius-lg);
$_rounded-xs: var(--radius-xs);

/* --- 2. Define Themes --- */
$light-theme: mat.define-theme((color: (theme-type: light,
        primary: mat.$azure-palette,
        tertiary: mat.$blue-palette,
      ),
      typography: (brand-family: 'inherit',
        plain-family: 'inherit',
      ),
      density: (scale: 0,
      )));

$dark-theme: mat.define-theme((color: (theme-type: dark,
        primary: mat.$azure-palette,
        tertiary: mat.$blue-palette,
      ),
      density: (scale: 0,
      )));


      $button-theme-overrides: (
  // =========================================================
  // 1. FILLED BUTTON (Primary Action)
  // =========================================================
  filled-container-shape: $_rounded-md,
  filled-container-color: $_sky-500,
  filled-label-text-color: #ffffff,
  filled-label-text-font: var(--tw-font-sans),
  filled-label-text-weight: 500,
  filled-horizontal-padding: 12px,
  filled-container-height:36px,
  
  // State Layers (Hover/Focus)
  filled-hover-state-layer-opacity: 0.08,
  filled-focus-state-layer-opacity: 0.12,
  filled-pressed-state-layer-opacity: 0.12,
  filled-state-layer-color: #ffffff, 
  // filled-ripple-color: #ffffff,

  // Disabled State
  filled-disabled-container-color: var(--tw-surface-50),
  filled-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 2. OUTLINED BUTTON (Secondary Action)
  // =========================================================
  outlined-container-shape: var(--tw-rounded-full),
  outlined-outline-color: var(--tw-primary-600),
  outlined-outline-width: 1px,
  outlined-label-text-color: var(--tw-primary-600),
  outlined-label-text-font: var(--tw-font-sans),
  outlined-label-text-weight: 500,

  // State Layers
  outlined-hover-state-layer-opacity: 0.04,
  outlined-focus-state-layer-opacity: 0.12,
  outlined-state-layer-color: var(--tw-primary-600),
  // outlined-ripple-color: var(--tw-primary-600),

  // Disabled State
  outlined-disabled-outline-color: var(--tw-text-disabled),
  outlined-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 3. TONAL BUTTON (Alternative Secondary)
  // =========================================================
  tonal-container-shape: var(--tw-rounded-full),
  tonal-container-color: var(--tw-secondary-100),
  tonal-label-text-color: var(--tw-primary-600),
  tonal-label-text-font: var(--tw-font-sans),
  tonal-label-text-weight: 600,

  // State Layers
  tonal-hover-state-layer-opacity: 0.08,
  tonal-state-layer-color: var(--tw-primary-600),
  // tonal-ripple-color: var(--tw-primary-600),

  // Disabled
  tonal-disabled-container-color: var(--tw-surface-50),
  tonal-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 4. TEXT BUTTON (Low Emphasis)
  // =========================================================
  text-label-text-color: var(--tw-primary-600),
  text-label-text-font: var(--tw-font-sans),
  text-label-text-weight: 500,
  text-container-shape: var(--tw-rounded-md), // Text buttons often look better less rounded

  // State Layers
  text-hover-state-layer-opacity: 0.04,
  text-state-layer-color: var(--tw-primary-600),
  // text-ripple-color: var(--tw-primary-600),

  // Disabled
  text-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 5. PROTECTED / ELEVATED BUTTON
  // =========================================================
  protected-container-shape: var(--tw-rounded-full),
  protected-container-color: #ffffff,
  protected-label-text-color: var(--tw-primary-600),
  protected-container-elevation-shadow: var(--tw-shadow-sm),
  
  // Hover/Press Shadows
  protected-hover-container-elevation-shadow: var(--tw-shadow-md),
  protected-pressed-container-elevation-shadow: var(--tw-shadow-sm),
  
  // State Layers
  protected-state-layer-color: var(--tw-primary-600),
  // protected-ripple-color: var(--tw-primary-600),

  // Disabled
  protected-disabled-container-color: var(--tw-surface-50),
  protected-disabled-label-text-color: var(--tw-text-disabled),
  protected-disabled-container-elevation-shadow: none
);

$dark-button-theme-overrides: (
  // =========================================================
  // 1. FILLED BUTTON (Primary Action)
  // =========================================================
  filled-container-shape: $_rounded-md,
  filled-container-color: $_slate-800,
  filled-label-text-color: #ffffff,
  filled-label-text-font: var(--tw-font-sans),
  filled-label-text-weight: 500,
  filled-horizontal-padding: 12px,
  filled-container-height:36px,
  
  // State Layers (Hover/Focus)
  filled-hover-state-layer-opacity: 0.08,
  filled-focus-state-layer-opacity: 0.12,
  filled-pressed-state-layer-opacity: 0.12,
  filled-state-layer-color: #ffffff, 
  // filled-ripple-color: #ffffff,

  // Disabled State
  filled-disabled-container-color: var(--tw-surface-50),
  filled-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 2. OUTLINED BUTTON (Secondary Action)
  // =========================================================
  outlined-container-shape: var(--tw-rounded-full),
  outlined-outline-color: var(--tw-primary-600),
  outlined-outline-width: 1px,
  outlined-label-text-color: var(--tw-primary-600),
  outlined-label-text-font: var(--tw-font-sans),
  outlined-label-text-weight: 500,

  // State Layers
  outlined-hover-state-layer-opacity: 0.04,
  outlined-focus-state-layer-opacity: 0.12,
  outlined-state-layer-color: var(--tw-primary-600),
  // outlined-ripple-color: var(--tw-primary-600),

  // Disabled State
  outlined-disabled-outline-color: var(--tw-text-disabled),
  outlined-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 3. TONAL BUTTON (Alternative Secondary)
  // =========================================================
  tonal-container-shape: var(--tw-rounded-full),
  tonal-container-color: var(--tw-secondary-100),
  tonal-label-text-color: var(--tw-primary-600),
  tonal-label-text-font: var(--tw-font-sans),
  tonal-label-text-weight: 600,

  // State Layers
  tonal-hover-state-layer-opacity: 0.08,
  tonal-state-layer-color: var(--tw-primary-600),
  // tonal-ripple-color: var(--tw-primary-600),

  // Disabled
  tonal-disabled-container-color: var(--tw-surface-50),
  tonal-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 4. TEXT BUTTON (Low Emphasis)
  // =========================================================
  text-label-text-color: var(--tw-primary-600),
  text-label-text-font: var(--tw-font-sans),
  text-label-text-weight: 500,
  text-container-shape: var(--tw-rounded-md), // Text buttons often look better less rounded

  // State Layers
  text-hover-state-layer-opacity: 0.04,
  text-state-layer-color: var(--tw-primary-600),
  // text-ripple-color: var(--tw-primary-600),

  // Disabled
  text-disabled-label-text-color: var(--tw-text-disabled),

  // =========================================================
  // 5. PROTECTED / ELEVATED BUTTON
  // =========================================================
  protected-container-shape: var(--tw-rounded-full),
  protected-container-color: #ffffff,
  protected-label-text-color: var(--tw-primary-600),
  protected-container-elevation-shadow: var(--tw-shadow-sm),
  
  // Hover/Press Shadows
  protected-hover-container-elevation-shadow: var(--tw-shadow-md),
  protected-pressed-container-elevation-shadow: var(--tw-shadow-sm),
  
  // State Layers
  protected-state-layer-color: var(--tw-primary-600),
  // protected-ripple-color: var(--tw-primary-600),

  // Disabled
  protected-disabled-container-color: var(--tw-surface-50),
  protected-disabled-label-text-color: var(--tw-text-disabled),
  protected-disabled-container-elevation-shadow: none
);

/* --- 3. Apply Themes & Overrides --- */
html {
  @include mat.all-component-themes($light-theme);

  @include mat.button-overrides($button-theme-overrides);

  // --- Form Field Overrides (Light) ---
  @include mat.form-field-overrides((
      filled-container-color: $_white,
      filled-label-text-color: rgb(100 116 139),
      filled-input-text-color: $_slate-900,
      filled-caret-color: $_sky-500,
      filled-focus-label-text-color: $_sky-500,
      filled-focus-active-indicator-color: $_sky-500,
      filled-error-label-text-color: $_error,
      filled-error-caret-color: $_error,
    ));

  // --- Dialog Overrides (Light) ---
  @include mat.dialog-overrides((container-color: $_white,
      subhead-color: $_slate-700,
      supporting-text-color: $_slate-700,
      container-shape: 1rem,
      container-elevation-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15),
    ));

  // --- Select Overrides (Light) ---
  @include mat.select-overrides((panel-background-color: $_white,
      enabled-trigger-text-color: $_slate-700,
      enabled-arrow-color: $_slate-700,
    ));

  // --- Menu Overrides (Light) ---
  @include mat.menu-overrides((container-color: $_white,
      item-label-text-color: $_slate-700,
      item-icon-color: $_slate-700,
      container-elevation-shadow:$_shadow-sm,
      item-hover-state-layer-color:$_gray_100 ));

  // --- Table Overrides (Light) ---
  @include mat.table-overrides((background-color: $_white,
      header-headline-color: $_slate-700,
      row-item-label-text-color: $_slate-900, // Text-slate-900
      row-item-outline-color: $_border-light, // Border-gray-200
      header-container-height: 45px, // Matches py-2.5 + line-height approx
      header-headline-size: 12px, // text-xs
      header-headline-weight: 500, // font-medium
    ));

  // Custom border for light mode dialogs
  .mat-mdc-dialog-surface {
    border: 1px solid rgba(226, 232, 240, 0.8);
  }
}

html.dark {
  @include mat.all-component-colors($dark-theme);

  @include mat.button-overrides($dark-button-theme-overrides);

  // --- Form Field Overrides (Dark) ---
  @include mat.form-field-overrides((
      filled-container-color: $_slate-950,
      filled-label-text-color: $_slate-300,
      filled-hover-label-text-color: $_slate-200,
      filled-input-text-color: $_slate-500,
      filled-active-indicator-color: $_slate-500,
      filled-focus-label-text-color: $_sky-500,
      filled-focus-active-indicator-color: $_sky-500,
      filled-error-label-text-color: $_error,
      filled-error-caret-color: $_error,
    ));

  // --- Dialog Overrides (Dark) ---
  @include mat.dialog-overrides((container-color: $_slate-900,
      subhead-color: $_slate-200,
      supporting-text-color: $_slate-200,
      container-elevation-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
    ));

  // --- Select Overrides (Dark) ---
  @include mat.select-overrides((panel-background-color: $_slate-800,
      enabled-trigger-text-color: $_slate-200,
      enabled-arrow-color: $_slate-200,
    ));

  // --- Menu Overrides (Dark) ---
  @include mat.menu-overrides((container-color: $_slate-800,
      item-label-text-color: $_slate-200,
      item-icon-color: $_slate-200,
      container-elevation-shadow:$_shadow-sm,
      item-hover-state-layer-color:$_slate-800 ));

  // --- Table Overrides (Dark) ---
  @include mat.table-overrides((background-color: var(--color-slate-950),
      header-headline-color: $_slate-300,
      row-item-label-text-color: $_slate-100,
      row-item-outline-color: $_border-dark,
      header-container-height: 45px,
      header-headline-size: 12px,
      header-headline-weight: 500, // Tailwind headers are usually medium even in dark
    ));

  // Custom border for dark mode dialogs
  .mat-mdc-dialog-surface {
    border: 1px solid rgba(71, 85, 105, 0.5);
  }

  // Overlay Backdrop
  .cdk-overlay-dark-backdrop {
    background: rgba(0, 0, 0, 0.75);
  }
}

// --- Form Fields ---
.mat-mdc-text-field-wrapper {
  height: 52px !important;
  border-radius: 0.5rem;


  &::before,
  &::after {
    display: none !important;
  }
}

html.dark .mat-mdc-text-field-wrapper {
  border-color: rgb(71 85 105);
}

// --- Menus & Panels ---
.mat-mdc-select-panel,
.mat-mdc-menu-panel {
  border: 1px solid rgba(226, 232, 240, 0.8);
  border-radius: 0.5rem !important;
}

html.dark .mat-mdc-select-panel,
html.dark .mat-mdc-menu-panel {
  border-color: rgba(71, 85, 105, 0.8);
}

// --- Hover States ---
.mat-mdc-option,
.mat-mdc-menu-item {

  &.mat-mdc-option-active,
  &:hover:not([disabled]) {
    background-color: $_sky-500-fade;
  }
}


// --- Table Header ---
.mat-mdc-header-cell {
  font-weight: 600 !important;
}

// --- Responsive Table Wrapper ---
.table-container {
  display: block;
  width: 100%;
  overflow-x: auto !important;
  border-radius: 0.5rem;
  background-color: $_white;

  .mat-mdc-table {
    width: 100%;
    min-width: 800px;

    // Nesting 'thead' here is cleaner and generates the exact same CSS
    thead {
      position: relative;
      z-index: 0;
    }
  }
}

html.dark .table-container {
  border-color: rgb(71 85 105);
  background-color: $_slate-900;
}


/* --- 5. Modern Scrollbar --- */

// Default (Light Mode)
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background-color: #cbd5e1; // slate-300
  border-radius: 9999px; // Full pill shape
  border: 2px solid transparent; // Adds "padding" to the thumb via background-clip
  background-clip: content-box;

  &:hover {
    background-color: #94a3b8; // slate-400
  }
}

// Dark Mode
html.dark {
  ::-webkit-scrollbar-thumb {
    background-color: #334155; // slate-700

    &:hover {
      background-color: #475569; // slate-600
    }
  }
}

/* --- 6. Dialog Size Utility Classes --- */
.dialog-sm {
  max-width: 95vw !important;
  
  .mat-mdc-dialog-surface {
    width: 400px !important;
    max-width: 95vw !important;
  }
}

.dialog-md {
  max-width: 95vw !important;
  
  .mat-mdc-dialog-surface {
    width: 600px !important;
    max-width: 95vw !important;
  }
}

.dialog-lg {
  max-width: 95vw !important;
  
  .mat-mdc-dialog-surface {
    width: 800px !important;
    max-width: 95vw !important;
  }
}

.dialog-xl {
    max-width: 95vw !important;
    
    .mat-mdc-dialog-surface {
      width: 1000px !important;
      max-width: 95vw !important;
    }
}

.dialog-full-screen {
  max-width: 100vw !important;
  width: 100vw !important;
  height: 100vh !important;
  max-height: 100vh !important;
  
  .mat-mdc-dialog-surface {
    border-radius: 0 !important;
    height: 100%;
    width: 100%;
    max-height: 100vh !important;
  }
}
